#include <stdio.h>
#include <cstdlib>

// remove the DC offset, code provided by Emotiv

float** dcoffsetgone(float* datamatrix[], int numof_rows)
{
	int i, r;
	float back[14];
	int	IIR_TC = 256;
	//copy the first row of data into 'back'
	for (i = 0; i < 14; i++)
		back[i] = datamatrix[i][0];

	for (r = 1; r < numof_rows; r++)
	{
		float tempback[14];
		for (i = 0; i < 14; i++)
			tempback[i] = back[i] * (IIR_TC - 1);
		for (i = 0; i < 14; i++)
			back[i] = (tempback[i] + datamatrix[i][r]) / IIR_TC;
		for (i = 0; i < 14; i++)
			datamatrix[i][r] = datamatrix[i][r] - back[i];

	}
	return datamatrix;
}

void display(float ** datamatrix)
{
	for (int i = 0; i < 14; i++)
	{
		for (int j = 0; j < 3; j++)
			printf("%f, ", datamatrix[i][j]);
		printf("\n");
	}
	printf("\n");
}

int main ()
{
	int i, j;
	float temp[5][14] = 
	{
	
	{4276.92297233867700000000, 4840.51270214685520000000, 4322.56399686363420000000, 4749.23065309694080000000, 4343.58963737513110000000, 4803.58962612666530000000, 4279.48707484007900000000, 4264.10245983166710000000, 4456.92296793710370000000, 4883.07680367013020000000, 4569.74347799879520000000, 4292.30758734708980000000, 4668.20501405263530000000, 4400.51271290625750000000},
	{4284.10245934260270000000, 4852.30757365330460000000, 4323.07681736391440000000, 4745.64090959497840000000, 4341.02553487372920000000, 4803.58962612666530000000, 4277.43579283895720000000, 4263.07681883110580000000, 4459.48707043850570000000, 4891.28193167461630000000, 4574.35886250131900000000, 4295.38451034877200000000, 4678.97424455852430000000, 4403.58963590793970000000},
	{4278.46143383951860000000, 4847.17936865050070000000, 4320.51271486251240000000, 4738.46142259105270000000, 4338.46143237232720000000, 4798.46142112386130000000, 4272.82040833643350000000, 4264.10245983166710000000, 4458.97424993822550000000, 4894.87167517657960000000, 4574.35886250131900000000, 4295.89733084905220000000, 4679.99988555908480000000, 4406.15373840934260000000},
	{4277.94861333923840000000, 4844.61526614909870000000, 4320.51271486251240000000, 4738.97424309133290000000, 4338.97425287260740000000, 4798.46142112386130000000, 4266.15374183278800000000, 4263.58963933138600000000, 4449.74348093317800000000, 4891.28193167461630000000, 4574.87168300159920000000, 4296.41015134933330000000, 4682.56398806048670000000, 4406.66655890962280000000},
	{4281.02553634092060000000, 4842.56398414797700000000, 4321.53835586307380000000, 4738.97424309133290000000, 4342.56399637457070000000, 4800.51270312498310000000, 4264.10245983166710000000, 4255.89733182718010000000, 4441.02553242841080000000, 4889.74347017377570000000, 4570.76911899935570000000, 4294.35886934821160000000, 4677.43578305768280000000, 4399.48707190569710000000 }
	
	};
	float ** datamatrix;
	datamatrix = (float**) malloc(14*sizeof(float*));
	for (i = 0; i < 14; i++)
	{
		datamatrix[i] = (float*) malloc(3* sizeof(float));
	}
	if (datamatrix == NULL)
	{
		printf("mallocfailed.");
	}
	datamatrix[0][0] = 1;
	for (i = 0; i < 14; i++)
	{
		for (j = 0; j < 3; j++)
		{
			datamatrix[i][j] = temp[j][i];
		}			
	}
	display(datamatrix);
	int numof_rows = 3;
	
	dcoffsetgone( datamatrix,  numof_rows);
	display(datamatrix);
	return 0;
}